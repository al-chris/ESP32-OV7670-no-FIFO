
ESP32-OV7670-no-FIFO
=====================

Lightweight driver for interfacing non-FIFO OV7670 camera modules with the ESP32 using the I2S peripheral and DMA for high-speed parallel capture.

Overview
--------
This library implements a hardware-accelerated data path so the ESP32 can capture frames from an OV7670 camera module that does not include a FIFO buffer. It uses:

- RMT for stable XCLK generation
- I2C (SCCB) for camera register configuration
- I2S in parallel (camera/LCD) mode with DMA to capture pixel data without CPU sampling
- A small BMP header helper so captured frames can be served over HTTP or saved as files

Features
--------
- XCLK generation using the RMT peripheral (robust across ESP32 core versions)
- SCCB/I2C camera configuration routines
- I2S parallel capture with DMA buffer management
- BMP header generator for 16-bit RGB565 frames
- Example: `CameraWebServer` — streams QQVGA (160x120) RGB565 frames via HTTP

Installation
------------
Copy the `ESP32-OV7670-no-FIFO` folder into your Arduino `libraries/` folder or keep it under the workspace `libraries/` directory so the Arduino IDE can find it.

Quick start
-----------
1. Open the example `examples/CameraWebServer/CameraWebServer.ino` in the Arduino IDE.
2. Edit the Wi-Fi credentials in the sketch.
3. Select your ESP32 board (e.g. "DOIT ESP32 DEVKIT V1") and the correct COM port.
4. Build and upload.
5. Open the Serial Monitor at 115200 to obtain the device IP and connect with a browser.

Recommended wiring (validated)
-------------------------------
Use the following pin mapping as a starting point — it's community-validated for ESP32-WROOM modules and avoids flash/strapping pins that commonly cause boot or signal issues.

OV7670 -> ESP32 (recommended)

- VCC -> 3.3V
- GND -> GND
- PWDN -> GND (disable power-down)
- RESET -> 3.3V (inactive)
- SIOC (SCL) -> GPIO 22 (SCCB clock)
- SIOD (SDA) -> GPIO 21 (SCCB data)
- XCLK -> GPIO 32 (generated by RMT)
- PCLK -> GPIO 33 (pixel clock input)
- VSYNC -> GPIO 34 (input-only)
- HREF -> GPIO 35 (input-only)
- D0 -> GPIO 27
- D1 -> GPIO 19
- D2 -> GPIO 18
- D3 -> GPIO 15
- D4 -> GPIO 14
- D5 -> GPIO 13
- D6 -> GPIO 12
- D7 -> GPIO 4

Notes:
- Use 4.7k pull-ups on SIOC and SIOD to 3.3V if your board/module does not provide them.
- Keep jumper wires short for XCLK, PCLK, and D0..D7 to reduce noise and timing issues.
- Avoid using GPIOs 6-11 (flash) and be careful with strapping pins (0,2,5,12,15).

Usage contract (what to expect)
-------------------------------
- Inputs: OV7670 module wired to the ESP32 as above, power at 3.3V, Wi-Fi (optional for web server example)
- Outputs: QQVGA RGB565 frames (160x120) captured into RAM and accessible via camera->frame; example serves BMP images over HTTP
- Error modes: SCCB/I2C failures if pull-ups/wiring incorrect; scrambled images if signal integrity, timing, or buffer alignment is wrong; memory allocation failures on devices without PSRAM when trying higher resolutions

Example
-------
See `examples/CameraWebServer/CameraWebServer.ino` for a full example that:

- Initializes the camera for QQVGA RGB565
- Connects to Wi‑Fi
- Starts an HTTP server and serves BMP frames at `/camera`

Troubleshooting
---------------
- No SCCB device found: check SIOC/SIOD wiring and pull-ups; run an I2C scanner sketch to confirm the camera address (usually 0x21).
- Scrambled or noisy image: shorten high-speed wires, add 10uF + 0.1uF decoupling caps on the camera VCC, verify XCLK stability.
- Wrong colors or vertical bands: verify VSYNC/HREF wiring and DMA buffer alignment and ensure the configured resolution matches the camera output.
- Boot loops or failure to upload: ensure you are not using flash pins (GPIO 6..11) and check strapping pins (GPIO 0, 2, 12, 15) states at reset.

Limitations
-----------
- Memory: the ESP32 internal SRAM is limited (~520KB). QQVGA (160x120 RGB565, ~38KB/frame) is safe; higher resolutions (QVGA/VGA) will quickly exhaust RAM unless you use a board with PSRAM (ESP32-WROVER).
- Real-time capture: this approach relies on I2S+DMA; do not attempt CPU-based bit-banging for pixel capture (it will miss pixels).

References and resources
------------------------
- bitluni/ESP32CameraI2S: https://github.com/bitluni/ESP32CameraI2S
- See `OV7670 Camera with ESP-32.md` in the project root for an extended engineering guide, wiring diagram, and troubleshooting notes.

License
-------
MIT
